<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π - API —Ç–µ—Å—Ç</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    section { margin-bottom: 30px; }
    input, button { margin: 5px; padding: 10px; }
    img { max-width: 200px; margin: 10px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>üñºÔ∏è –ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π API</h1>

  <section>
    <h2>1. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h2>
    <button onclick="getImages()">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
    <div id="imageList"></div>
  </section>

  <section>
    <h2>2. –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</h2>
    <input type="text" id="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è">
    <input type="file" id="fileInput" accept="image/*">
    <button onclick="uploadImage()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
    <p id="uploadStatus"></p>
  </section>

  <section>
    <h2>3. –£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</h2>
    <input type="number" id="deleteId" placeholder="ID –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è">
    <button onclick="deleteImage()">–£–¥–∞–ª–∏—Ç—å</button>
    <p id="deleteStatus"></p>
  </section>

  <script>
    const API_URL = 'http://localhost:3000/api/images';

    async function getImages() {
      const res = await fetch(API_URL);
      const data = await res.json();
      const container = document.getElementById('imageList');
      container.innerHTML = '';
      data.data.forEach(img => {
        const div = document.createElement('div');
        div.innerHTML = `
          <strong>${img.id}: ${img.title}</strong><br>
          <img src="/uploads/${img.filename}" alt="${img.title}">
          <hr>
        `;
        container.appendChild(div);
      });
    }

    async function uploadImage() {
      const fileInput = document.getElementById('fileInput');
      const title = document.getElementById('title').value;
      const formData = new FormData();
      formData.append('image', fileInput.files[0]);
      formData.append('title', title);

      const res = await fetch(API_URL, {
        method: 'POST',
        body: formData
      });
      const result = await res.json();
      document.getElementById('uploadStatus').innerText = 
        result.success ? '‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ!' : '‚ùå –û—à–∏–±–∫–∞: ' + result.message;
      if (result.success) getImages();
    }

    async function deleteImage() {
      const id = document.getElementById('deleteId').value;
      const res = await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
      const result = await res.json();
      document.getElementById('deleteStatus').innerText = 
        result.success ? '‚úÖ –£–¥–∞–ª–µ–Ω–æ!' : '‚ùå –û—à–∏–±–∫–∞: ' + result.message;
      if (result.success) getImages();
    }
  </script>
</body>
</html>